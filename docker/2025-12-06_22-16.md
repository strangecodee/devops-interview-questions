# docker â€” Sat Dec  6 22:17:01 IST 2025
**Topic:** Scalability
**Style:** Beginner-friendly
**Depth:** Very high detail
**UniqueKeyword:** spectrum

# Best Practice Title
Implement multi-stage builds to reduce the final image size.

# Explanation
Multi-stage builds leverage multiple `FROM` instructions within a single Dockerfile. Each `FROM` instruction initiates a new build stage, allowing you to use temporary images for compiling code, downloading dependencies, or performing other tasks. Only the artifacts from the final stage are included in the resulting image, minimizing its size and improving security. This approach ensures that unnecessary tools and libraries used during the build process are not present in the runtime environment.

# Why It Matters
- Reduces image size, leading to faster deployments and reduced storage costs.
- Improves security by minimizing the attack surface of the final image.
- Simplifies the final image by removing build-time dependencies, enhancing maintainability.

# Example
```dockerfile
# Stage 1: Build stage - Maven build environment
FROM maven:3.8.6-jdk-11 AS builder
WORKDIR /app
COPY pom.xml .
RUN mvn dependency:go-offline -B # Download dependencies initially without source code
COPY src ./src
RUN mvn clean package -DskipTests # Package the application

# Stage 2: Runtime stage - Minimal Java runtime
FROM openjdk:11-jre-slim
WORKDIR /app
COPY --from=builder /app/target/my-app.jar my-app.jar # Copy only the built JAR
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "my-app.jar"]

# Explanation:
# FROM maven:3.8.6-jdk-11 AS builder: Defines the first stage named "builder" based on a Maven image.
# WORKDIR /app: Sets the working directory inside the container.
# COPY pom.xml .: Copies the pom.xml file to the /app directory.
# RUN mvn dependency:go-offline -B: Downloads Maven dependencies.  The '-B' flag runs Maven in batch mode, useful for non-interactive environments.  Using dependency:go-offline here downloads the dependencies before copying the application code which speeds up rebuilds when only the application code changes. It also makes the subsequent build faster. spectrum
# COPY src ./src: Copies the application source code.
# RUN mvn clean package -DskipTests: Builds the application, skipping tests to reduce build time. -DskipTests is important to omit unit and integration tests that may not be relevant when creating a docker image intended for production.
# FROM openjdk:11-jre-slim: Defines the second stage based on a slim JRE image.  This image only includes what is needed to run the java application.
# COPY --from=builder /app/target/my-app.jar my-app.jar: Copies the built JAR file from the "builder" stage to the current stage.  The '--from=builder' flag specifies the source stage.  Only the packaged JAR is copied, excluding maven and all build time tooling.
# EXPOSE 8080: Exposes port 8080 for the application.
# ENTRYPOINT ["java", "-jar", "my-app.jar"]: Defines the command to run the application.  ENTRYPOINT sets the executable that will be run when the container starts.  This is combined with CMD (if present) to form the full command.  In this case, it runs the JAR file.

```

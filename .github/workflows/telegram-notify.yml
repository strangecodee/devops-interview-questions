name: Telegram Notifications

on:
  workflow_run:
    workflows:
      - "Daily DevOps Content Generator (Gemini)"
      - "Weekly DevOps Summary (Gemini)"
      - "Update Dashboard"
      - "Generate Repo Badges"
    types:
      - completed

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Telegram Notification
        env:
          BOT: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          STATUS="${{ github.event.workflow_run.conclusion }}"
          WF="${{ github.event.workflow_run.name }}"
          DATE="$(date)"

          if [ "$STATUS" = "success" ]; then
            RAW_MESSAGE="üéâ *Workflow Success!*\n\nWorkflow: *$WF*\nStatus: SUCCESS\nDate: $DATE\n\nEverything looks good! üöÄ"
          else
            RAW_MESSAGE="‚ö†Ô∏è *Workflow Failed!*\n\nWorkflow: *$WF*\nStatus: FAILED\nDate: $DATE\n\nPlease check the GitHub Actions logs. üõ†Ô∏è"
          fi

          # Encode message to base64 (YAML-safe)
          ENCODED=$(echo "$RAW_MESSAGE" | base64)

          # Decode and send to Telegram
          curl -s -X POST "https://api.telegram.org/bot$BOT/sendMessage" \
            -d chat_id="$CHAT" \
            -d parse_mode="Markdown" \
            -d text="$(echo "$ENCODED" | base64 --decode)"

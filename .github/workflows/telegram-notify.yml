name: Telegram Notifications

on:
  workflow_run:
    workflows:
      - "Daily DevOps Content Generator (Gemini)"
      - "Weekly DevOps Summary (Gemini)"
      - "Update Dashboard"
      - "Generate Repo Badges"
    types:
      - completed

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Telegram Notification
        env:
          BOT: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          STATUS="${{ github.event.workflow_run.conclusion }}"
          WF="${{ github.event.workflow_run.name }}"
          DATE="$(date)"

          if [ "$STATUS" = "success" ]; then
            read -r -d '' MSG << EOF
            ðŸŽ‰ *Workflow Success!*
            *Workflow:* $WF
            *Status:* SUCCESS
            *Date:* $DATE
            EOF
          else
            read -r -d '' MSG << EOF
            âš ï¸ *Workflow Failed!*
            *Workflow:* $WF
            *Status:* FAILED
            *Date:* $DATE
            EOF
          fi

          curl -s -X POST "https://api.telegram.org/bot$BOT/sendMessage" \
            -d chat_id="$CHAT" \
            -d parse_mode="Markdown" \
            -d text="$MSG"

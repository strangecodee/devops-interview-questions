name: Telegram Notifications

on:
  workflow_run:
    workflows:
      - "Daily DevOps Content Generator (Gemini)"
      - "Weekly DevOps Summary (Gemini)"
      - "Update Dashboard"
      - "Generate Repo Badges"
    types:
      - completed

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          STATUS=${{ github.event.workflow_run.conclusion }}
          WORKFLOW_NAME="${{ github.event.workflow_run.name }}"
          DATE=$(date +'%Y-%m-%d %H:%M:%S')

          if [ "$STATUS" = "success" ]; then
            MSG="ğŸ‰ *Workflow Completed Successfully!*

            ğŸ“ Workflow: *$WORKFLOW_NAME*
            ğŸ“… Date: $DATE
            ğŸ Status: *SUCCESS*

            ğŸ”§ Repo: ${{ github.repository }}"

          else
            MSG="âš ï¸ *Workflow Failed!*

            ğŸ“ Workflow: *$WORKFLOW_NAME*
            ğŸ“… Date: $DATE
            âŒ Status: *FAILED*

            ğŸ›  Please check the logs in GitHub Actions."

          fi

          curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
            -d chat_id="$CHAT_ID" \
            -d text="$MSG" \
            -d parse_mode="Markdown"

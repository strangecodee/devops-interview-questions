name: Update README

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Update README
        run: |
          set -e

          if grep -q "Last Updated:" README.md 2>/dev/null; then
            sed -i "s/\*Last Updated:.*\*/\*Last Updated: $(date -u +'%a %b %d %H:%M:%S UTC %Y') \*/" README.md
          else
            echo '<h1 align="center">DevOps Interview Questions Repository</h1>' > README.md
            echo '<p align="center">' >> README.md
            echo '<img src="https://cdn.simpleicons.org/linux" width="40"/>' >> README.md
            echo '<img src="https://cdn.simpleicons.org/docker" width="40"/>' >> README.md
            echo '<img src="https://cdn.simpleicons.org/kubernetes" width="40"/>' >> README.md
            echo '<img src="https://cdn.simpleicons.org/jenkins" width="40"/>' >> README.md
            echo '</p>' >> README.md
            echo "" >> README.md

            echo "<h2>About</h2>" >> README.md
            echo "This repository is an auto-maintained DevOps Interview & Practice Hub covering Linux, Docker, Kubernetes, CI/CD and Cloud." >> README.md
            echo "" >> README.md

            echo "<h2>Technology Stack</h2>" >> README.md
            echo "- Linux" >> README.md
            echo "- Docker" >> README.md
            echo "- Kubernetes" >> README.md
            echo "- Jenkins / CI-CD" >> README.md
            echo "- GitHub Actions" >> README.md
            echo "" >> README.md

            echo "<h2>Content Areas</h2>" >> README.md
            echo "- [DevOps Interview](./devops-interview)" >> README.md
            echo "- [Docker](./docker)" >> README.md
            echo "- [Kubernetes](./kubernetes)" >> README.md
            echo "- [CI/CD](./cicd)" >> README.md
            echo "" >> README.md

            echo "<h2>Dashboard</h2>" >> README.md
            echo "Live stats: [View Dashboard](./DASHBOARD.md)" >> README.md
            echo "" >> README.md

            echo "*Last Updated: $(date -u +'%a %b %d %H:%M:%S UTC %Y')*" >> README.md
          fi

      - name: Configure Git
        run: |
          git config --global user.name "README Bot"
          git config --global user.email "bot@github.com"
          git remote set-url origin https://github-actions:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}

      - name: Commit and push if changed
        run: |
          git add README.md
          git commit -m "docs(readme): auto-update README content" || exit 0
          git push